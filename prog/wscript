from os.path import join, basename
from glob import glob
import sys

VERSION='0'
APPNAME='ZtoWll'

srcdir = '.'

program_file = 'main.cpp'

sources = [basename(i) for i in glob(join(srcdir, '*.cpp'))]
sources.remove(program_file)

blddir = 'build'

import Utils


def set_options(opt):
    opt.tool_options('compiler_cxx')
    opt.tool_options('boost')

def configure(conf):
    conf.check_tool('compiler_cxx')
    conf.check_tool('boost')

    conf.env['CXXFLAGS'] += ["--std=c++0x"]

    # Check for ROOT
    rc = conf.find_program('root-config')
    get = lambda name: Utils.cmd_output("%s --%s" % (rc, name)).strip().split()
    conf.env['CXXFLAGS_ROOT'] = get('auxcflags')
    conf.env['LIBPATH_ROOT'] = get('libdir')
    conf.env['CPPPATH_ROOT'] = get('incdir')
    conf.env['LINKFLAGS_ROOT'] = get('libs')
    conf.env['LIB_ROOT'] = ['TreePlayer']

    conf.check_boost(min_version='1.37', uselib_store='BOOST')

def build(bld):
    task = bld.new_task_gen()
    task.features = 'cxx cprogram'
    task.source = sources + [program_file]
    task.target = APPNAME
    task.uselib = "ROOT BOOST"

